---
published: false
---




## 카드 번호 직접 입력 결제 (`KEYIN`)

- KeyIn 결제는 online에서 결제하더라도, offline 결제로 침
    - 카드 번호를 직접 입력 받는 행위는 offline에서 일어나는 일이기 때문




---




## KeyIn의 결제 금액 제한

- '가맹점 + 카드사' 기준으로 지정된 결제 제한 금액 이상을 결제할 수 없음
    - offline 결제는 카드를 분실했을 때, 다른 사람이 사용하는 사고가 발생할 수 있기 때문임

- 한달 동안 결제 금액을 누적하여 제한 금액과 비교함
    - 결제 금액은 달이 지나면 다시 초기화 됨

- 가맹점이 keyin 결제 제한 금액을 높이기 위해서는 보증 보험이 필요함


### KeyIn 일정 금액 초과 결제 제한 기능 구현 방식

- KeyIn 결제를 관리하는 table에 '사업장', '제한 금액', '결제된 금액', '금액 초과 결제 제한 날짜'에 대한 column이 있음

- 결제할 때 제한된 결제 금액을 넘으면, '결제가 제한된 날짜'를 설정함
    - 제한된 결제 금액을 넘었는지는 VAN사에 요청하여 응답받는 `제한 초과 code`를 보고 알 수 있음

- 다음 달이 되었을 때는 결제된 금액 초기화 후, 다시 해당 월에 맞도록 '결제된 금액'을 update
    - 현재 month가 table에 등록된 month보다 늦는지 확인하고 실행함
    - `merchant_credit_card_management` table의 pay_app_cd column으로 비교하여 결제 가능 여부를 결정함




---




## KeyIn 결제 카드 인증

- KeyIn 결제 카드를 인증하는 방법으로는 "신인증"과 "구인증"이 있음
    - 인증에 필요한 정보는 virtual keyboard로 입력받음

| 종류 | 설명 | 필요 정보 |
| --- | --- | --- |
| 신인증 | 일반 카드 인증 | 카드 번호, 유효 기간 |
| 구인증 | 신인증 보다 더 정확하게 확인하는 인증 | 카드 번호, 유효 기간, 비밀 번호 앞 두 자리 |

- 카드 정보를 잘못 입력했는데, 다른 사람의 카드 정보에 들어맞는 경우가 있어서 구인증 과정이 추가됨
    - 구인증을 할 때는 `신인증에서 받는 정보 + 생년월일 + 비밀 번호 앞 두자리`를 받음

- 페이민트의 KeyIn 카드 인증은 이전에 구인증을 한 적이 있는 고객이라면, 이후에는 신인증만 하도록 되어 있음